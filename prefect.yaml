# prefect.yaml (NA RAIZ do projeto)
name: gov-tercerizados
prefect-version: 3.4.9

build:
  - prefect_docker.deployments.steps.build_docker_image:
      id: build-image
      requires: prefect-docker
      image_name: gov-tercerizados
      tag: latest
      path: "."                # Como o YAML está na raiz, "." pega tudo
      dockerfile: "Dockerfile" # Dockerfile está na mesma pasta
      nocache: true

push: null

pull:
  - prefect.deployments.steps.set_working_directory:
      directory: "/app"       # Caminho padrão dentro do container

deployments:
  - name: gov-tercerizados
    # Caminho do flow a partir da raiz
    entrypoint: "pipelines/gov_tercerizados/flow.py:gov_tercerizados_flow"
    work_pool:
      name: "gov-tercerizados-v2"      # Use o nome do seu pool configurado
    job_variables:
      image: "{{ build-image.image }}"
      image_pull_policy: Never
      env:
        PYTHONPATH: "/app"    # Permite que o Python ache as pastas 'dw' e 'pipelines'